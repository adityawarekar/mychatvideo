{% extends 'base/main.html' %}
{% block content %}

<div class="lobby">

   
    <h1>ðŸŽ¥ MyChat</h1>
    <p>Connect with friends instantly</p>

    
    <div class="users">
        <h3>ðŸ‘¥ Users</h3>

        {% if profiles %}
            <ul>
                {% for profile in profiles %}
                    <li>
                        <strong>{{ profile.user.username }}</strong>
                        {% if profile.status == 'online' %}
                            <span style="color: green;">ðŸŸ¢ Online</span>
                        {% elif profile.status == 'in_call' %}
                            <span style="color: orange;">ðŸŽ¥ In Call</span>
                        {% else %}
                            <span style="color: red;">ðŸ”´ Offline</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No other users yet</p>
        {% endif %}
    </div>

    <hr>

    
    <form id="form">
        <input name="room" placeholder="Enter Room Name" required />
        <button type="submit">Join Room</button>
    </form>

</div>

<script>
document.getElementById('form').onsubmit = async (e) => {
    e.preventDefault()

    const room = e.target.room.value.toUpperCase()

    try {
        const res = await fetch(`/get_token/?channel=${room}`)
        const data = await res.json()

        sessionStorage.setItem('room', room)
        sessionStorage.setItem('uid', data.uid)
        sessionStorage.setItem('token', data.token)

        window.location.href = '/room/'
    } catch (error) {
        console.error('Error:', error)
        alert('Failed to join room. Please try again.')
    }
}
</script>

{% endblock %}
